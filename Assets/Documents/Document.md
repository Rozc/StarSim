# 《崩坏：星穹铁道》战斗机制重建项目文档

本文档旨在说明本项目的概况与项目中各目录、文件的结构和作用。

## 1. 项目概况

本项目 (以下简称 StarSim) 旨在分析与重建游戏《崩坏：星穹铁道》(以下简称《崩铁》) 中的回合制战斗机制，项目重点在于机制的实现，
因此在数值、动画、特效、UI 方面将显得较为简陋。

《崩铁》的战斗机制是以速度为基础的回合制机制，辅以战斗属性、弱点击破、行动插队等机制，配合各个角色各有不同的机制，
和设计独特的怪物，形成了具有多样性的战斗机制。

## 2. 战斗系统拆解

《崩铁》的战斗系统主要可以分为以下 3 个部分
1. 行动系统
2. 交互系统
3. 事件系统

其中**交互系统**指参加战斗的游戏对象之间的交互，可以细分为
1. 伤害系统
2. Buff 系统

本章剩余内容将详细介绍这几个系统

### 2.1 行动系统
《崩铁》的战斗中，所有参与战斗的对象依照**行动值**依次行动，所有对象都具有两个属性：
1. 速度
2. 距离

其中<u>速度</u>是对象的一个固有属性，由对象本身数值、装备数值和当前持有的 Buff 决定，
而<u>距离</u>则是一个进入战斗后才获得的实时属性，在战斗开始时，所有目标的距离 (默认) 将被设定为 10000.

而具体的行动机制则可以比喻成所有角色都在一条长度为 10000 米的环形跑道上运动，速度的单位则被认为是**米每秒**，
当一个角色跑完了 10000 米而又回到起点时，就进入该角色的<u>回合</u>。
由此，<u>行动值</u>可由以下这个简单的公式计算：行动值 = 距离 / 速度。也就是说，行动值就是角色距离下一个回合
所需的时间。当跑到终点的角色行动完之后，他又会从起点出发，进入下一圈。

由于是回合制的战斗，我们可以认为角色在进行行动时的时间是停滞的，也就是所有对象都需要暂停其前进，等到行动中
的角色行动结束，才会继续在这个 10000 米的跑道上前进，直到进入下一个对象的回合。

此外，在《崩铁》中，<u>回合</u>与<u>行动</u>是两个不同的概念，回合就如上文所描述的，当一个角色的行动值
达到 0 时，进入其<u>回合</u>，而<u>行动</u>则是对象进行一次动作的最小粒度，一个回合中可以包含多个行动，
当其中所有的行动都结束后，该回合才结束。

![img.png](img.png)

如上图，可以认为纵向排列的是各对象的回合，而横向排列的是各对象的行动，一个回合内可以有多个行动。

一般来说，每个回合中至少包含一个当前回合所有者的行动，称之为<u>主要行动</u>，对象可以在该行动中释放其技能 
(对于玩家操控的角色来说则是普通攻击或战技)，如果没有其他行动的加入，在主要行动结束后将会进入回合结束阶段。
与主要行动相对的则是<u>额外行动</u>和<u>追加行动</u>，这两种行动都在满足某些条件后产生，其区别 (我认为) 
仅在于是否需要玩家输入，如各角色的终结技则是一种最典型的额外行动，其在角色能量充满且玩家按下对应按键时生成，
并插入到当前回合中，然后等待玩家输入。而角色”克拉拉“的反击则是一种典型的追加行动，其在角色受到攻击时自动产生
并插入到当前回合中，并且不需要玩家输入，自动执行。
